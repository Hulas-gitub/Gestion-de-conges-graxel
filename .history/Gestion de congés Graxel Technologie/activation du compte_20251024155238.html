<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Graxel Technologies - Activation du Compte</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/notyf@3/notyf.min.css">
    <link rel="stylesheet" href="./assets/css/new password.css">
    <link rel="icon" type="image/png" href="assets/images/logo.png">
    <style>
        /* Responsive pour version bureau - Layout horizontal */
        @media (min-width: 768px) {
            .login-container {
                max-width: 900px !important;
                width: 90% !important;
            }
            
            .password-reset-header {
                margin-bottom: 2rem !important;
            }
            
            #activationForm {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 2rem;
                align-items: start;
            }
            
            .form-group:first-child,
            .form-group:nth-child(2) {
                margin-bottom: 0 !important;
            }
            
            .security-requirements {
                grid-column: 1 / -1;
                margin-top: 1rem;
            }
            
            .submit-btn {
                grid-column: 1 / -1;
                margin-top: 1rem;
            }
        }
        
        /* Version mobile reste verticale */
        @media (max-width: 767px) {
            .login-container {
                max-width: 440px;
            }
        }
    </style>
</head>
<body>
    <!-- Loader -->
    <div class="loader-container" id="loader">
        <div class="loader-spinner"></div>
        <div class="loader-text">Préparation de l'activation de votre compte...</div>
        <div class="loader-progress">
            <div class="loader-progress-bar"></div>
        </div>
        <div class="loader-subtitle">Bienvenue chez Graxel Technologies...</div>
    </div>
    <!-- Main Content -->
    <div class="main-content" id="mainContent">
        <div class="login-container">
            <button class="theme-toggle" id="themeToggle" aria-label="Changer de thème">
                <i class="fas fa-moon"></i>
            </button>
            <!-- Bouton retour -->
            <button class="back-btn" id="backBtn" aria-label="Retour à la connexion">
                <i class="fas fa-arrow-left"></i>
                <span>Retour</span>
            </button>
            <div class="logo-container">
                <div style="width: 70px; height: 70px; background: linear-gradient(135deg, #3B82F6, #1D4ED8); border-radius: 16px; display: flex; align-items: center; justify-content: center; margin: 0 auto;">
                    <i class="fas fa-user-check" style="font-size: 1.75rem; color: white;"></i>
                </div>
            </div>

            <div class="password-reset-header">
                <div class="reset-icon">
                    <i class="fas fa-user-plus"></i>
                </div>
                <h1 class="title">Activation du Compte</h1>
                <p class="subtitle">Créez votre mot de passe pour activer votre compte Graxel Technologies</p>
            </div>
            <form id="activationForm">
                <div class="form-group">
                    <label for="password" class="form-label">
                        <i class="fas fa-lock"></i>
                        Mot de passe
                    </label>
                    <div class="input-wrapper">
                        <input
                            type="password"
                            id="password"
                            class="form-input"
                            placeholder="Créez votre mot de passe"
                            required
                        >
                        <i class="fas fa-key input-icon"></i>
                        <button type="button" class="password-toggle" id="passwordToggle" aria-label="Afficher/masquer le mot de passe">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                    <div class="password-strength" id="passwordStrength">
                        <div class="strength-bar">
                            <div class="strength-fill" id="strengthFill"></div>
                        </div>
                        <p class="strength-text" id="strengthText">
                            <i class="fas fa-info-circle"></i>
                            Saisissez un mot de passe
                        </p>
                    </div>
                </div>
                <div class="form-group">
                    <label for="confirmPassword" class="form-label">
                        <i class="fas fa-check-double"></i>
                        Confirmer le mot de passe
                    </label>
                    <div class="input-wrapper">
                        <input
                            type="password"
                            id="confirmPassword"
                            class="form-input"
                            placeholder="Confirmez votre mot de passe"
                            required
                        >
                        <i class="fas fa-check-double input-icon"></i>
                        <button type="button" class="password-toggle" id="confirmPasswordToggle" aria-label="Afficher/masquer le mot de passe">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                    <div class="password-match" id="passwordMatch"></div>
                </div>
                <!-- Critères de sécurité -->
                <div class="security-requirements">
                    <h3 class="requirements-title">
                        <i class="fas fa-shield-check"></i>
                        Critères de sécurité
                    </h3>
                    <ul class="requirements-list">
                        <li class="requirement" id="lengthReq">
                            <i class="fas fa-circle requirement-icon"></i>
                            Au moins 8 caractères
                        </li>
                        <li class="requirement" id="uppercaseReq">
                            <i class="fas fa-circle requirement-icon"></i>
                            Une lettre majuscule (A-Z)
                        </li>
                        <li class="requirement" id="lowercaseReq">
                            <i class="fas fa-circle requirement-icon"></i>
                            Une lettre minuscule (a-z)
                        </li>
                        <li class="requirement" id="numberReq">
                            <i class="fas fa-circle requirement-icon"></i>
                            Au moins un chiffre (0-9)
                        </li>
                    </ul>
                </div>
                <button type="submit" class="submit-btn" id="submitBtn">
                    <span class="btn-text">Activer mon compte</span>
                    <i class="fas fa-check-circle submit-icon"></i>
                    <div class="btn-loader" style="display: none;">
                        <i class="fas fa-spinner fa-spin"></i>
                    </div>
                </button>
            </form>
        </div>
    </div>
    <!-- Modal de Confirmation -->
    <div class="modal" id="confirmModal">
        <div class="modal-content">
            <div class="modal-icon warning">
                <i class="fas fa-user-check"></i>
            </div>
            <h3 class="modal-title">Confirmer l'activation</h3>
            <p class="modal-message">
                Êtes-vous sûr de vouloir activer votre compte avec ce mot de passe ?
                Vous pourrez vous connecter immédiatement après l'activation.
            </p>
            <div class="modal-actions">
                <button class="modal-btn secondary" id="cancelBtn">Annuler</button>
                <button class="modal-btn primary" id="confirmBtn">Activer</button>
            </div>
        </div>
    </div>
    <!-- Modal de Succès -->
    <div class="modal" id="successModal">
        <div class="modal-content">
            <div class="modal-icon success">
                <i class="fas fa-check-circle"></i>
            </div>
            <h3 class="modal-title">Compte activé avec succès !</h3>
            <p class="modal-message">
                Votre compte Graxel Technologies est maintenant actif.
                Vous allez être redirigé vers la page de connexion.
            </p>
            <div class="modal-actions">
                <button class="modal-btn primary" id="okBtn">Continuer</button>
            </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/notyf@3/notyf.min.js"></script>
    <script>
        // Initialisation de Notyf
        const notyf = new Notyf({
            duration: 4000,
            position: { x: 'right', y: 'top' },
            types: [
                {
                    type: 'success',
                    background: '#10B981',
                    icon: { className: 'fas fa-check-circle', tagName: 'i', color: 'white' }
                },
                {
                    type: 'error',
                    background: '#EF4444',
                    icon: { className: 'fas fa-exclamation-circle', tagName: 'i', color: 'white' }
                },
                {
                    type: 'warning',
                    background: '#F59E0B',
                    icon: { className: 'fas fa-exclamation-triangle', tagName: 'i', color: 'white' }
                }
            ]
        });

        // Gestion du loader
        window.addEventListener('load', function() {
            const loader = document.getElementById('loader');
            const mainContent = document.getElementById('mainContent');

            setTimeout(() => {
                loader.classList.add('hide');
                setTimeout(() => {
                    loader.style.display = 'none';
                    mainContent.classList.add('show');
                    animateFormElements();
                }, 500);
            }, 2500);
        });

        // Animation des éléments du formulaire
        function animateFormElements() {
            const elements = document.querySelectorAll('.form-group, .security-requirements, .submit-btn');
            elements.forEach((el, index) => {
                el.style.opacity = '0';
                el.style.transform = 'translateY(30px)';

                setTimeout(() => {
                    el.style.transition = 'all 0.6s cubic-bezier(0.4, 0, 0.2, 1)';
                    el.style.opacity = '1';
                    el.style.transform = 'translateY(0)';
                }, index * 150);
            });
        }

        // Gestion du thème
        const themeToggle = document.getElementById('themeToggle');
        const body = document.body;
        let currentTheme = 'dark';

        themeToggle.addEventListener('click', () => {
            if (currentTheme === 'light') {
                body.removeAttribute('data-theme');
                themeToggle.innerHTML = '<i class="fas fa-moon"></i>';
                currentTheme = 'dark';
            } else {
                body.setAttribute('data-theme', 'light');
                themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
                currentTheme = 'light';
            }
        });

        // Bouton retour
        document.getElementById('backBtn').addEventListener('click', () => {
            window.location.href = '../index.html';
        });

        // Gestion des boutons de visibilité des mots de passe
        const passwordToggles = document.querySelectorAll('.password-toggle');
        passwordToggles.forEach(toggle => {
            toggle.addEventListener('click', () => {
                const input = toggle.parentElement.querySelector('input');
                const icon = toggle.querySelector('i');

                if (input.type === 'password') {
                    input.type = 'text';
                    icon.className = 'fas fa-eye-slash';
                } else {
                    input.type = 'password';
                    icon.className = 'fas fa-eye';
                }
            });
        });

        // Éléments pour la validation du mot de passe
        const passwordInput = document.getElementById('password');
        const confirmPasswordInput = document.getElementById('confirmPassword');
        const strengthFill = document.getElementById('strengthFill');
        const strengthText = document.getElementById('strengthText');
        const passwordMatch = document.getElementById('passwordMatch');

        // Critères de sécurité
        const requirements = {
            length: document.getElementById('lengthReq'),
            uppercase: document.getElementById('uppercaseReq'),
            lowercase: document.getElementById('lowercaseReq'),
            number: document.getElementById('numberReq')
        };

        // Fonction de validation de la force du mot de passe
        function checkPasswordStrength(password) {
            let score = 0;
            const checks = {
                length: password.length >= 8,
                uppercase: /[A-Z]/.test(password),
                lowercase: /[a-z]/.test(password),
                number: /[0-9]/.test(password),
                special: /[^A-Za-z0-9]/.test(password)
            };

            // Bonus pour longueur supplémentaire
            let lengthBonus = 0;
            if (password.length >= 12) lengthBonus = 1;
            if (password.length >= 16) lengthBonus = 2;

            // Mise à jour des critères visuels
            Object.keys(checks).forEach(key => {
                const req = requirements[key];
                if (req) {
                    const icon = req.querySelector('.requirement-icon');

                    if (checks[key]) {
                        req.classList.add('met');
                        icon.className = 'fas fa-check-circle requirement-icon';
                        score++;
                    } else {
                        req.classList.remove('met');
                        icon.className = 'fas fa-circle requirement-icon';
                    }
                }
            });

            // Calcul du score total avec bonus
            const totalScore = score + lengthBonus;
            let level = 'none';
            let percentage = 0;
            let icon = 'fas fa-info-circle';
            let message = 'Saisissez un mot de passe';

            // Détermination du niveau de solidité
            if (password.length === 0) {
                level = 'none';
                percentage = 0;
                icon = 'fas fa-info-circle';
                message = 'Saisissez un mot de passe';
            } else if (totalScore <= 1) {
                level = 'very-weak';
                percentage = 15;
                icon = 'fas fa-exclamation-triangle';
                message = 'Très faible - Ajoutez plus d\'éléments';
            } else if (totalScore === 2) {
                level = 'weak';
                percentage = 30;
                icon = 'fas fa-exclamation-circle';
                message = 'Faible - Améliorez votre mot de passe';
            } else if (totalScore === 3) {
                level = 'fair';
                percentage = 50;
                icon = 'fas fa-minus-circle';
                message = 'Moyen - Ajoutez plus de caractères';
            } else if (totalScore === 4) {
                level = 'good';
                percentage = 70;
                icon = 'fas fa-check-circle';
                message = 'Bon - Presque parfait !';
            } else if (totalScore === 5) {
                level = 'strong';
                percentage = 85;
                icon = 'fas fa-shield-check';
                message = 'Fort - Excellent choix !';
            } else if (totalScore >= 6) {
                level = 'excellent';
                percentage = 100;
                icon = 'fas fa-crown';
                message = 'Excellent - Sécurité maximale !';
            }

            // Mise à jour de la barre et du texte
            strengthFill.style.width = `${percentage}%`;
            strengthFill.className = `strength-fill ${level}`;
            strengthText.className = `strength-text ${level}`;
            strengthText.innerHTML = `<i class="${icon}"></i> ${message}`;

            // Animation de la barre
            strengthFill.style.transform = 'scaleX(0)';
            setTimeout(() => {
                strengthFill.style.transform = 'scaleX(1)';
                strengthFill.style.transformOrigin = 'left';
                strengthFill.style.transition = 'transform 0.4s cubic-bezier(0.4, 0, 0.2, 1)';
            }, 50);

            return score >= 4;
        }

        // Fonction de vérification de la correspondance des mots de passe
        function checkPasswordMatch() {
            const password = passwordInput.value;
            const confirmPassword = confirmPasswordInput.value;

            if (confirmPassword === '') {
                passwordMatch.innerHTML = '';
                passwordMatch.className = 'password-match';
                return false;
            }

            if (password === confirmPassword) {
                passwordMatch.innerHTML = '<i class="fas fa-check-circle"></i> Les mots de passe correspondent parfaitement';
                passwordMatch.className = 'password-match success';
                return true;
            } else {
                passwordMatch.innerHTML = '<i class="fas fa-times-circle"></i> Les mots de passe ne correspondent pas';
                passwordMatch.className = 'password-match error';
                return false;
            }
        }

        // Validation en temps réel
        passwordInput.addEventListener('input', (e) => {
            checkPasswordStrength(e.target.value);
            if (confirmPasswordInput.value) {
                checkPasswordMatch();
            }

            e.target.style.transform = 'scale(1.02)';
            setTimeout(() => {
                e.target.style.transform = 'scale(1)';
            }, 150);
        });

        confirmPasswordInput.addEventListener('input', (e) => {
            checkPasswordMatch();

            e.target.style.transform = 'scale(1.02)';
            setTimeout(() => {
                e.target.style.transform = 'scale(1)';
            }, 150);
        });

        // Gestion des modales
        const confirmModal = document.getElementById('confirmModal');
        const successModal = document.getElementById('successModal');
        const cancelBtn = document.getElementById('cancelBtn');
        const confirmBtn = document.getElementById('confirmBtn');
        const okBtn = document.getElementById('okBtn');

        function showModal(modal) {
            modal.classList.add('show');
            document.body.style.overflow = 'hidden';
        }

        function hideModal(modal) {
            modal.classList.remove('show');
            document.body.style.overflow = '';
        }

        // Événements des modales
        cancelBtn.addEventListener('click', () => {
            hideModal(confirmModal);
            notyf.open({ type: 'warning', message: 'Activation annulée' });
        });

        confirmBtn.addEventListener('click', () => {
            hideModal(confirmModal);
            processActivation();
        });

        okBtn.addEventListener('click', () => {
            hideModal(successModal);
            redirectToLogin();
        });

        // Fermeture des modales en cliquant à l'extérieur
        [confirmModal, successModal].forEach(modal => {
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    hideModal(modal);
                }
            });
        });

        // Traitement de l'activation
        function processActivation() {
            const submitBtn = document.getElementById('submitBtn');
            const btnText = submitBtn.querySelector('.btn-text');
            const submitIcon = submitBtn.querySelector('.submit-icon');
            const btnLoader = submitBtn.querySelector('.btn-loader');

            submitBtn.disabled = true;
            btnText.style.display = 'none';
            submitIcon.style.display = 'none';
            btnLoader.style.display = 'inline-block';

            const progressMessages = [
                'Création de votre compte...',
                'Configuration de la sécurité...',
                'Activation en cours...'
            ];

            let messageIndex = 0;
            const progressInterval = setInterval(() => {
                if (messageIndex < progressMessages.length) {
                    notyf.open({
                        type: 'success',
                        message: progressMessages[messageIndex],
                        duration: 1000
                    });
                    messageIndex++;
                }
            }, 800);

            setTimeout(() => {
                clearInterval(progressInterval);

                submitBtn.disabled = false;
                btnText.style.display = 'inline';
                submitIcon.style.display = 'inline';
                btnLoader.style.display = 'none';

                showModal(successModal);
                notyf.success('Compte activé avec succès !');
                createSuccessParticles();
            }, 3500);
        }

        // Redirection vers la page de connexion
        function redirectToLogin() {
            document.querySelector('.login-container').style.transform = 'scale(0.95)';
            document.querySelector('.login-container').style.opacity = '0';

            setTimeout(() => {
                window.location.href = '../index.html';
            }, 500);
        }

        // Soumission du formulaire
        const activationForm = document.getElementById('activationForm');

        activationForm.addEventListener('submit', (e) => {
            e.preventDefault();

            const password = passwordInput.value.trim();
            const confirmPassword = confirmPasswordInput.value.trim();

            if (!password) {
                notyf.error('Veuillez saisir un mot de passe');
                passwordInput.focus();
                return;
            }

            if (password.length < 8) {
                notyf.error('Le mot de passe doit contenir au moins 8 caractères');
                passwordInput.focus();
                return;
            }

            if (!confirmPassword) {
                notyf.error('Veuillez confirmer votre mot de passe');
                confirmPasswordInput.focus();
                return;
            }

            if (!checkPasswordStrength(password)) {
                notyf.error('Le mot de passe ne respecte pas les critères de sécurité minimum');
                passwordInput.focus();
                return;
            }

            if (!checkPasswordMatch()) {
                notyf.error('Les mots de passe ne correspondent pas');
                confirmPasswordInput.focus();
                return;
            }

            const commonPasswords = [
                'password', '123456', '12345678', 'qwerty', 'abc123',
                'password123', 'admin', 'letmein', 'welcome', 'monkey'
            ];

            if (commonPasswords.includes(password.toLowerCase())) {
                notyf.error('Ce mot de passe est trop commun. Choisissez quelque chose de plus unique.');
                passwordInput.focus();
                return;
            }

            showModal(confirmModal);
        });

        // Animation au focus des champs
        const inputs = document.querySelectorAll('.form-input');
        inputs.forEach(input => {
            input.addEventListener('focus', (e) => {
                e.target.style.transform = 'translateY(-2px)';
                e.target.style.boxShadow = '0 8px 25px rgba(59, 130, 246, 0.15)';
            });

            input.addEventListener('blur', (e) => {
                e.target.style.transform = '';
                e.target.style.boxShadow = '';
            });
        });

        // Gestion des raccourcis clavier
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                if (confirmModal.classList.contains('show')) {
                    hideModal(confirmModal);
                }
                if (successModal.classList.contains('show')) {
                    hideModal(successModal);
                }
            }

            if (e.key === 'Enter') {
                if (confirmModal.classList.contains('show')) {
                    confirmBtn.click();
                }
                if (successModal.classList.contains('show')) {
                    okBtn.click();
                }
            }
        });

        // Effet de particules sur le succès
        function createSuccessParticles() {
            const colors = ['#10B981', '#34D399', '#6EE7B7', '#A7F3D0'];

            for (let i = 0; i < 15; i++) {
                const particle = document.createElement('div');
                particle.style.position = 'fixed';
                particle.style.width = '6px';
                particle.style.height = '6px';
                particle.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                particle.style.borderRadius = '50%';
                particle.style.pointerEvents = 'none';
                particle.style.zIndex = '10001';
                particle.style.left = Math.random() * window.innerWidth + 'px';
                particle.style.top = Math.random() * window.innerHeight + 'px';
                particle.style.opacity = '1';
                particle.style.transform = 'scale(0)';
                particle.style.transition = 'all 2s cubic-bezier(0.4, 0, 0.2, 1)';

                document.body.appendChild(particle);

                setTimeout(() => {
                    particle.style.transform = 'scale(1) translateY(-100px)';
                    particle.style.opacity = '0';
                }, 50);

                setTimeout(() => {
                    particle.remove();
                }, 2050);
            }
        }

        // Fonction utilitaire pour la validation en temps réel
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // Optimisation des validations avec debounce
        const debouncedPasswordCheck = debounce((password) => {
            checkPasswordStrength(password);
        }, 300);

        const debouncedMatchCheck = debounce(() => {
            checkPasswordMatch();
        }, 300);
    </script>
</body>
</html>